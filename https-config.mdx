---
title: Local HTTPS with mkcert & local-ssl-proxy
description: Run your local app over HTTPS using mkcert certificates and local-ssl-proxy.
---

## Overview

This guide shows you how to run a local React/Next.js (or similar) app over HTTPS using mkcert and local-ssl-proxy.

Assumptions:

- Your app already runs locally over HTTP on port `3001`.
- You want to access it over HTTPS on `https://local.staging-app.virtualspace.ai` or `https://local.app.virtualspace.ai` via port `3000`.
- You need HTTPS for things like cookies, OAuth, or PWA/service worker behavior.

## Prerequisites

You should have:

- A working local app running on HTTP (for example, `http://localhost:3001`).
- [mkcert](https://github.com/FiloSottile/mkcert) installed.
- `local-ssl-proxy` available (typically via `npx`).
- Permission to edit your system hosts file.

### Hosts file configuration

Add entries so your custom local domains resolve to `127.0.0.1`.

For example:

- `local.staging-app.virtualspace.ai` → `127.0.0.1`
- `local.app.virtualspace.ai` → `127.0.0.1`

On most systems, the hosts file locations are:

- macOS / Linux: `/etc/hosts`
- Windows: `C:\Windows\System32\drivers\etc\hosts`

Add lines like:

```txt
127.0.0.1 local.staging-app.virtualspace.ai
127.0.0.1 local.app.virtualspace.ai
```

## Steps

### 1. Trust the local CA

Install the mkcert root certificate on your machine (one-time step):

```bash
mkcert -install
```

This lets your OS and browsers trust certificates generated by mkcert.

### 2. Generate certificates for your local domains

Create a certificate for your staging-like local domain:

```bash
mkcert local.staging-app.virtualspace.ai
```

This generates files similar to:

- `local.staging-app.virtualspace.ai.pem`
- `local.staging-app.virtualspace.ai-key.pem`

Create a certificate for your production-like local domain:

```bash
mkcert local.app.virtualspace.ai
```

This generates:

- `local.app.virtualspace.ai.pem`
- `local.app.virtualspace.ai-key.pem`

Keep these files in a convenient directory (for example, your app root).

### 3. Run your app on HTTP (port 3001)

Start your app as usual on HTTP:

```bash
npm run dev
# or
yarn dev
# or whatever you normally use
```

Confirm it is accessible at something like:

```txt
http://localhost:3001
```

### 4. Start local-ssl-proxy for the staging domain

In a separate terminal, run local-ssl-proxy and point it at your HTTP app.

Example for staging:

```bash
NODE_OPTIONS=--dns-result-order=ipv4first npx local-ssl-proxy \
  --key local.staging-app.virtualspace.ai-key.pem \
  --cert local.staging-app.virtualspace.ai.pem \
  --source 3000 \
  --target 3001
```

What this does:

- Listens on HTTPS port `3000`.
- Uses your mkcert key and cert for `local.staging-app.virtualspace.ai`.
- Proxies all traffic to `http://localhost:3001`.

Now open:

```txt
https://local.staging-app.virtualspace.ai:3000
```

If your browser warns about the certificate, ensure:

- You ran `mkcert -install`.
- The hostname in the URL matches the certificate (`local.staging-app.virtualspace.ai`).
- The hosts file points the domain to `127.0.0.1`.

### 5. Start local-ssl-proxy for the production-like domain (optional)

If you also want a prod-like local domain, you can either:

- Reuse the same proxy and just use one domain at a time, or
- Run a second proxy on another port.

Example: run a second proxy on port `3443` for `local.app.virtualspace.ai`:

```bash
NODE_OPTIONS=--dns-result-order=ipv4first npx local-ssl-proxy \
  --key local.app.virtualspace.ai-key.pem \
  --cert local.app.virtualspace.ai.pem \
  --source 3443 \
  --target 3001
```

Then open:

```txt
https://local.app.virtualspace.ai:3443
```

## Troubleshooting

### Browser still says the certificate is not trusted

Check:

1. You ran `mkcert -install` successfully.
2. You restarted your browser after installing the mkcert root.
3. The URL hostname exactly matches the certificate:
   - Use `https://local.staging-app.virtualspace.ai:3000` with the `local.staging-app.virtualspace.ai` cert.
4. The time and date on your machine are correct.

### Cannot resolve the domain

Check your hosts file:

- Ensure lines like the following exist and are not commented out:

  ```txt
  127.0.0.1 local.staging-app.virtualspace.ai
  127.0.0.1 local.app.virtualspace.ai
  ```

- Flush DNS or restart your browser if necessary.

### Proxy starts but the page does not load

- Confirm your app is really running on port `3001`.
- Verify the `--target` matches the app port.
- Try hitting `http://localhost:3001` directly to ensure the app itself is working.